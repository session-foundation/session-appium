name: 'Run Android Tests'
description: 'Run Android tests with specified configuration'

inputs:
  PLATFORM:
    description: 'Platform to test (android/ios)'
    required: true
  RISK:
    description: 'Risk level to test'
    required: true
  WORKERS_COUNT:
    description: 'Number of Playwright workers'
    required: true
  DEVICES_PER_TEST:
    description: 'Number of devices per test'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Run ${{ inputs.DEVICES_PER_TEST }}-device tests
      id: run-tests
      shell: bash
      env:
        PLAYWRIGHT_WORKERS_COUNT: ${{ inputs.WORKERS_COUNT }}
        DEVICES_PER_TEST_COUNT: ${{ inputs.DEVICES_PER_TEST }}
        _TESTING: ${{ env._TESTING }}
        PRINT_FAILED_TEST_LOGS: ${{ env.PRINT_FAILED_TEST_LOGS }}
        PRINT_ONGOING_TEST_LOGS: ${{ env.PRINT_ONGOING_TEST_LOGS }}
      run: |
        echo "Running ${{ inputs.DEVICES_PER_TEST }} tests with ${{ inputs.WORKERS_COUNT }} workers"

        grep="(?=.*@${{ inputs.PLATFORM }})(?=.*@${{ inputs.DEVICES_PER_TEST }}-devices)"
        [[ "${{ inputs.RISK }}" != "" ]] && grep="${grep}(?=.*@${{ inputs.RISK }})"

        npx playwright test --grep "$grep"

outputs:
  test-result:
    description: 'Test result (success/failure)'
    value: ${{ steps.run-tests.outcome }}
